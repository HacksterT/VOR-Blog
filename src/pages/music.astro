---
import BaseLayout from '../layouts/BaseLayout.astro';
import musicData from '../data/music.json';

const allMusic = musicData;
---

<BaseLayout title="My Music" description="Original music from the Voice of Repentance YouTube channel.">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-12 md:py-16">
    <div class="mb-12 text-center">
      <h1 class="text-4xl md:text-5xl text-vor-charcoal mb-4">My Music</h1>
      <p class="text-lg text-vor-charcoal-light leading-relaxed max-w-2xl mx-auto">
        Original music from the Voice of Repentance. Songs born from a journey
        of faith, reflection, and worship.
      </p>
      <a
        href="https://www.youtube.com/@VoiceofRepentance"
        target="_blank"
        rel="noopener noreferrer"
        class="inline-flex items-center mt-4 text-sm font-heading font-medium text-vor-gold-dark hover:text-vor-gold no-underline"
      >
        <svg class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="currentColor">
          <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814z" />
          <polygon fill="#fff" points="9.545,15.568 15.818,12 9.545,8.432" />
        </svg>
        Subscribe on YouTube
      </a>
    </div>

    {/* Carousel navigation â€” centered above the player */}
    <div class="max-w-2xl mx-auto">
      <div class="flex items-center justify-center gap-6 mb-6">
        <button
          id="carousel-prev"
          style="color: #A8863E; font-size: 2rem; background: none; border: none; cursor: pointer; line-height: 1;"
          aria-label="Previous song"
        >&#9664;</button>

        <p id="carousel-counter" class="text-sm font-heading text-vor-muted">
          1 of {allMusic.length}
        </p>

        <button
          id="carousel-next"
          style="color: #A8863E; font-size: 2rem; background: none; border: none; cursor: pointer; line-height: 1;"
          aria-label="Next song"
        >&#9654;</button>
      </div>

      {/* Card */}
      <div
        id="carousel-card"
        class="bg-white rounded-xl border border-vor-sand overflow-hidden shadow-sm"
      >
        <div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;">
          <iframe
            id="carousel-video"
            src={`https://www.youtube.com/embed/${allMusic[0].id}`}
            title={allMusic[0].title}
            style="position:absolute;top:0;left:0;width:100%;height:100%;"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen
          ></iframe>
        </div>
        <div class="p-6">
          <span id="carousel-type" class="text-xs font-heading text-vor-gold-dark uppercase tracking-wider">
            {allMusic[0].type === 'song' ? 'Song' : 'Music Video'}
          </span>
          <h3 id="carousel-title" class="mt-1 text-xl font-heading font-semibold text-vor-charcoal">
            {allMusic[0].title}
          </h3>
          <p id="carousel-desc" class="mt-2 text-vor-charcoal-light text-sm leading-relaxed">
            {allMusic[0].description}
          </p>
          {allMusic[0].blogPost && (
            <a
              id="carousel-link"
              href={allMusic[0].blogPost}
              class="inline-flex items-center mt-4 text-sm font-heading font-medium text-vor-gold-dark hover:text-vor-gold no-underline"
            >
              Read the full story
              <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </a>
          )}
        </div>
      </div>

      {/* Dots indicator */}
      <div id="carousel-dots" class="flex items-center justify-center gap-2 mt-6">
        {allMusic.map((_, i) => (
          <button
            data-dot={i}
            class:list={[
              'w-2.5 h-2.5 rounded-full transition-colors',
              i === 0 ? 'bg-vor-gold' : 'bg-vor-sand hover:bg-vor-gold/50',
            ]}
            aria-label={`Go to song ${i + 1}`}
          ></button>
        ))}
      </div>
    </div>
  </div>
</BaseLayout>

<script define:vars={{ musicData: allMusic }}>
  let current = 0;
  const total = musicData.length;

  const iframe = document.getElementById('carousel-video');
  const title = document.getElementById('carousel-title');
  const desc = document.getElementById('carousel-desc');
  const type = document.getElementById('carousel-type');
  const link = document.getElementById('carousel-link');
  const counter = document.getElementById('carousel-counter');
  const prevBtn = document.getElementById('carousel-prev');
  const nextBtn = document.getElementById('carousel-next');
  const dots = document.querySelectorAll('[data-dot]');

  function update() {
    const item = musicData[current];

    iframe.src = `https://www.youtube.com/embed/${item.id}`;
    iframe.title = item.title;
    title.textContent = item.title;
    desc.textContent = item.description || '';
    type.textContent = item.type === 'song' ? 'Song' : 'Music Video';
    counter.textContent = `${current + 1} of ${total}`;

    if (link) {
      if (item.blogPost) {
        link.href = item.blogPost;
        link.style.display = '';
      } else {
        link.style.display = 'none';
      }
    }

    dots.forEach((dot, i) => {
      dot.classList.toggle('bg-vor-gold', i === current);
      dot.classList.toggle('bg-vor-sand', i !== current);
    });
  }

  prevBtn.addEventListener('click', () => {
    current = (current - 1 + total) % total;
    update();
  });

  nextBtn.addEventListener('click', () => {
    current = (current + 1) % total;
    update();
  });

  dots.forEach((dot) => {
    dot.addEventListener('click', () => {
      current = parseInt(dot.dataset.dot);
      update();
    });
  });

  update();
</script>
